<body>
    <p>This test ensures if an image with decoding="async" is decoded after the first paint, it will not flicker.</p>
    <img id="image" decoding="async" src="">
    <script>
        if (window.internals && window.testRunner) {
            internals.clearMemoryCache();
            testRunner.waitUntilDone();
        }

        function setImageSrc() {
            var image = document.getElementById("image");
            image.onload = (() => {
                // Force layout and display so the image frame starts decoding.
                document.body.offsetHeight;
                if (window.testRunner)
                    testRunner.notifyDone();
            });
            image.src = "resources/green-400x400.png";
        }
        requestAnimationFrame(setImageSrc);
    </script>
</body>
